# tests/tests_skipped/test_validation.py
# flake8: noqa: E501
from typing import Dict, Any
from pydantic import BaseModel, ValidationError
from pydantic import Json

from app.support.parser.utils.html_parser import parse_html_to_dict, parse_html_to_dict_simple, convert_to_json
from app.core.utils.common_utils import jprint
import json


test_html = ("<div id=\"cont_txt\">\n<h1>ВОДКА   «ПШЕНИЧНАЯ СТАНДАРТ»</h1><h2>Федеральный реестр алкогольной "
              "продукции</h2><p style=\"background-color: #ffff99; font-size: 13px; padding: 0px;\">Федеральная государственная информационная система «Федеральный реестр алкогольной продукции» (далее – ФРАП), выведена из эксплуатации приказом Росалкогольрегулирования от 29.10.2021 № 383.</p>\n<div style=\"width: 300px; padding-bottom: 30px; padding-top: 20px;\"><form action=\"/federalnyi-reestr-alkogolnoi-produktcii/search.html\" class=\"search\" method=\"post\"><input class=\"input\" name=\"str\" placeholder=\"Поиск в реестре\" type=\"text\"/><input class=\"submit\" name=\"\" type=\"submit\" value=\"\"/></form></div>\n<h4>Сведения из реестра:</h4>\n<p></p>\n<div style=\"padding: 10px; font-size: 13px;\"><em>\n<div class=\"two_sixth first\">Регистрационный номер (номер реестровой записи уведомления о начале оборота на территории Российской Федерации алкогольной продукции в системе)</div>\n<div class=\"three_fifth\">02-00022522</div> <div class=\"two_sixth first\">Уведомление (номер уведомления о начале оборота на территории Российской Федерации алкогольной продукци организации)</div>\n<div class=\"three_fifth\">№ 44 от 23.04.2015</div> <div class=\"two_sixth first\">Уведомитель (полное и сокращенное наименование организации представившей уведомление о начале оборота на территории Российской Федерации алкогольной продукции)</div>\n<div class=\"three_fifth\">Открытое акционерное общество \"Уржумский спиртоводочный завод\"</div> <div class=\"two_sixth first\">Производители (полное и сокращенное наименование производтеля алкогольной продукции)</div>\n<div class=\"three_fifth\">РОССИЯ 4334003671/433401001 Открытое акционерное общество \"Уржумский спиртоводочный завод\"</div> <div class=\"two_sixth first\">Наименование продукции (присвоенное производителем и предназначенное для обозначения алкогольной продукции слово или группа слов, под которыми она выпускается в оборот)</div>\n<div class=\"three_fifth\">ВОДКА   «ПШЕНИЧНАЯ СТАНДАРТ»</div> <div class=\"two_sixth first\">Наименование на языке производителя</div>\n<div class=\"three_fifth\">ВОДКА   «ПШЕНИЧНАЯ СТАНДАРТ»</div> <div class=\"two_sixth first\">Крепость от (минимальное содержание этилового спирта (процентов) в алкогольной продукции )</div>\n<div class=\"three_fifth\">40</div> <div class=\"two_sixth first\">Крепость до (максимальное содержание этилового спирта (процентов) в алкогольной продукции )</div>\n<div class=\"three_fifth\">40</div> <div class=\"two_sixth first\">Емкости (объем и наименование емкости в которую разлита алкогольная продкуция)</div>\n<div class=\"three_fifth\">0.2500, стеклянная бутылка;0.5000, стеклянная бутылка</div> <div class=\"two_sixth first\">Состав (перечень компонетов алкогольной продукции (для винных напитков, пива и пивных напитков - доли (проценты) используемых компонентов на момент производства алкогольной продукции))</div>\n<div class=\"three_fifth\">вода питьевая исправленная :  спирт этиловый ректификованный из пищевого сырья «Люкс»:  сахарный сироп :  настой спиртованный пшеницы :  загуститель глицерин (Е422): </div> <div class=\"two_sixth first\">Срок годности (установленный производителем алкогольной продукции срок годности на данный вид алкогольной продукции)</div>\n<div class=\"three_fifth\">не ограничен</div> <div class=\"two_sixth first\">Идентификационный  документ (наименование) (наименование документа, в соответствии с которым произведена алкогольная продукция, в том числе национальных или международных стандартов и иной технической документации)</div>\n<div class=\"three_fifth\">1.ГОСТ 12712-2013 «Водки и водки особые. Общие технические условия». 2. Технологические инструкции по производству ВОДКИ «ПШЕНИЧНАЯ СТАНДАРТ» 3. Рецептуры по производству ВОДКИ «ПШЕНИЧНАЯ СТАНДАРТ». 4.Производственные технологические регламенты по производству водок, водок особых, изделий ликероводочных на ОАО «Уржумский спиртоводочный завод». 5. «Производственный технологический регламент на производство водок и ликероводочных изделий».  6. Технический регламент таможенного союза «О безопасност</div> <div class=\"two_sixth first\">Идентификационный документ (номер) (реквизиты документа, в соответствии с которым произведена алкогольная продукция)</div>\n<div class=\"three_fifth\">1.ГОСТ 12712-2013, 2. ТИ 9181-0095-2015, ТИ 9181-0138-2015; 3. РЦ 9181-0095-2015, РЦ 9181-0138-2015; 4. ПТР 10-001-011-46095268-2013, ПТР 10-46095268-003-2015;  5. ПТР 10-12292-99; 6. ТР/ТС 021/2011 7.ПТР 10-46095268-004-2017 8. ТИ 9181-0264-2021  9.РЦ 9181-0264-2021   10.ПТР 10-46095268-006-2021</div> <div class=\"two_sixth first\">Температура от (минимальная температура хранения алкогольной продукции (градусов Цельсия))</div>\n<div class=\"three_fifth\">минус 15 С</div> <div class=\"two_sixth first\">Температура до  (максимальная температура хранения алкогольной продукции (градусов Цельсия))</div>\n<div class=\"three_fifth\">плюс 30 С</div> <div class=\"two_sixth first\">Влажность (относительная влажность (процентов) хранения алкогольной продукции)</div>\n<div class=\"three_fifth\">не выше 85%</div> <div class=\"two_sixth first\">Категория алкогольной продукции</div>\n<div class=\"three_fifth\">водка</div> <div class=\"two_sixth first\">Код ОКП</div>\n<div class=\"three_fifth\">91 8117 9</div> <div class=\"two_sixth first\">Код ОКПД2</div>\n<div class=\"three_fifth\">11.01.10.111</div> <div class=\"two_sixth first\">Код ТН ВЭД ТС</div>\n<div class=\"three_fifth\">2208 90 690 9</div> <div class=\"two_sixth first\">Вид алкогольной продукции по 171 федеральному закону</div>\n<div class=\"three_fifth\">200</div> <div class=\"two_sixth first\">Декларация</div>\n<div class=\"three_fifth\">№ RU Д-RU.АЯ15.В.03311</div> <div class=\"two_sixth first\">Дата первой поставки</div>\n<div class=\"three_fifth\">27.04.2015 00:00:00</div> <div class=\"two_sixth first\">Сведения о товарном знаке</div>\n<div class=\"three_fifth\">отсутствует</div> <div class=\"two_sixth first\">Условия перевозки алкогольной продукции </div>\n<div class=\"three_fifth\">Транспортировка транспортом всех видов в крытых транспортных средствах в соответствии с правилами перевозки грузов, действующими на транспорте данного вида, при температуре от минус 15 гр.С до плюс 30гр.С</div> <div class=\"two_sixth first\">Условия реализации алкогольной продукции</div>\n<div class=\"three_fifth\">Реализация при соблюдении условий хранения и сроков годности, установленных изготовителем</div> <div class=\"two_sixth first\">Условия утилизации алкогольной продукции</div>\n<div class=\"three_fifth\">Утилизации подлежит  пищевая продукция , не соответствующая ГОСТ 12712-2013, ТР ТС 021/2011</div> <div class=\"two_sixth first\">Другие отличительные характеристики</div>\n<div class=\"three_fifth\">отсутствуют</div> <div class=\"two_sixth first\">Примечание</div>\n<div class=\"three_fifth\">лицензия № 43ПСН0010297 от 31.05.2021г</div> <div class=\"two_sixth first\">Маркировка, фото, подробная информация</div>\n<div class=\"three_fifth\"><a href=\"/federalnyi-reestr-alkogolnoi-produktcii/download/59C4BCF2-8306-4402-9D59-99C6B5B4E6D7\" title=\"Скачать файл маркировки алкогольной продукции\">Скачать</a> </div></em></div>\n<div class=\"full_width clear\"></div>\n<p> </p>\n<p></p>\n<div class=\"adfinity_block_9680\"></div> </div>")
data = "{\n  \"product_name\": \"ВОДКА   «ПШЕНИЧНАЯ СТАНДАРТ»\",\n  \"регистрационный_номер_но\": \"02-00022522\",\n  \"уведомление_номер_уведом\": \"№ 44 от 23.04.2015\",\n  \"уведомитель_полное_и_сок\": \"Открытое акционерное общество \\\"Уржумский спиртоводочный завод\\\"\",\n  \"производители_полное_и_с\": \"РОССИЯ 4334003671/433401001 Открытое акционерное общество \\\"Уржумский спиртоводочный завод\\\"\",\n  \"наименование_продукции_п\": \"ВОДКА   «ПШЕНИЧНАЯ СТАНДАРТ»\",\n  \"наименование_на_языке_про\": \"ВОДКА   «ПШЕНИЧНАЯ СТАНДАРТ»\",\n  \"крепость_от_минимальное_\": \"40\",\n  \"крепость_до_максимальное\": \"40\",\n  \"емкости_объем_и_наименов\": \"0.2500, стеклянная бутылка;0.5000, стеклянная бутылка\",\n  \"состав_перечень_компонет\": \"вода питьевая исправленная :  спирт этиловый ректификованный из пищевого сырья «Люкс»:  сахарный сироп :  настой спиртованный пшеницы :  загуститель глицерин (Е422):\",\n  \"срок_годности_установлен\": \"не ограничен\",\n  \"идентификационный_докуме\": \"1.ГОСТ 12712-2013 «Водки и водки особые. Общие технические условия». 2. Технологические инструкции по производству ВОДКИ «ПШЕНИЧНАЯ СТАНДАРТ» 3. Рецептуры по производству ВОДКИ «ПШЕНИЧНАЯ СТАНДАРТ». 4.Производственные технологические регламенты по производству водок, водок особых, изделий ликероводочных на ОАО «Уржумский спиртоводочный завод». 5. «Производственный технологический регламент на производство водок и ликероводочных изделий».  6. Технический регламент таможенного союза «О безопасност\",\n  \"идентификационный_докумен\": \"1.ГОСТ 12712-2013, 2. ТИ 9181-0095-2015, ТИ 9181-0138-2015; 3. РЦ 9181-0095-2015, РЦ 9181-0138-2015; 4. ПТР 10-001-011-46095268-2013, ПТР 10-46095268-003-2015;  5. ПТР 10-12292-99; 6. ТР/ТС 021/2011 7.ПТР 10-46095268-004-2017 8. ТИ 9181-0264-2021  9.РЦ 9181-0264-2021   10.ПТР 10-46095268-006-2021\",\n  \"температура_от_минимальн\": \"минус 15 С\",\n  \"температура_до_максимал\": \"плюс 30 С\",\n  \"влажность_относительная_\": \"не выше 85%\",\n  \"категория_алкогольной_про\": \"водка\",\n  \"код_окп\": \"91 8117 9\",\n  \"код_окпд2\": \"11.01.10.111\",\n  \"код_тн_вэд_тс\": \"2208 90 690 9\",\n  \"вид_алкогольной_продукции\": \"200\",\n  \"декларация\": \"№ RU Д-RU.АЯ15.В.03311\",\n  \"дата_первой_поставки\": \"27.04.2015 00:00:00\",\n  \"сведения_о_товарном_знаке\": \"отсутствует\",\n  \"условия_перевозки_алкогол\": \"Транспортировка транспортом всех видов в крытых транспортных средствах в соответствии с правилами перевозки грузов, действующими на транспорте данного вида, при температуре от минус 15 гр.С до плюс 30гр.С\",\n  \"условия_реализации_алкого\": \"Реализация при соблюдении условий хранения и сроков годности, установленных изготовителем\",\n  \"условия_утилизации_алкого\": \"Утилизации подлежит  пищевая продукция , не соответствующая ГОСТ 12712-2013, ТР ТС 021/2011\",\n  \"другие_отличительные_хара\": \"отсутствуют\",\n  \"примечание\": \"лицензия № 43ПСН0010297 от 31.05.2021г\",\n  \"маркировка_фото_подробн\": \"Скачать\"\n}"


class RawDataModel(BaseModel):
    parsed_data: Json[Dict[str, Any]]

def test_valid():
    from pydantic import BaseModel, ValidationError
    import json
    try:
        dict_tmp = {'product_name': 'ПРОДУКТ', 'НОМЕР': '85%'}
        dict_tmp, _ = parse_html_to_dict(test_html)
        tmp_json = json.dumps(dict_tmp)
        tmp_json = convert_to_json(dict_tmp)
        tmp_model = RawDataModel(parsed_data = tmp_json)
    except ValidationError as exc:
        for error in exc.errors():
            print(f"  Место ошибки (loc): {error['loc']}")
            print(f"  Сообщение (msg): {error['msg']}")
            print(f"  Тип ошибки (type): {error['type']}")
            # input_value обычно присутствует в словаре ошибки
            if 'input_value' in error:
                print(f"  Некорректное значение (input_value): {error['input_value']}")
            print("-" * 20)
        assert False, 'ошибка валидации'
    assert True